---
layout: post
title: "是否該寫測試碼的判斷"
categories: Job QA
tag: 
date: 2018-08-08 23:59:59 UTC+8 
last_modified_at: 2018-08-08 23:59:59 UTC+8 
---

# 前言

單元測試是單位最小，數量最多的一類測試，從前一篇 ( [測試碼與產品碼的差異](https://no129.github.io/qa/2018/08/06/QA-002-TestCodeVsProductCode.html) ) 提到測試碼 ( Test Code ) 的價值來自產品碼的風險，同時考量撰寫測試碼所耗用的資源，對於是否需要撰寫對應的測試碼，必須合理客觀的判斷。

# 測試應針對具備風險的產品碼

測試碼的價值來自於產品碼的風險控制，因此，應該針對「具備風險」的產品碼方法測試，部分幾乎不可能造成風險的程式碼，基本上不用特別撰寫對應測試碼，以下列示幾種幾乎不可能造成風險的情境。

## 純粹的屬性存取無需測試

對於公開的屬性，若是單純回傳或設定內部參數值，則無需進行測試，然而若是取得或設定的程序包含邏輯，例如，延遲生成或是快取，則仍需考量加以測試的必要。

## 私有函式無需測試

私有函式無需特別測試，因為私有函式應該直接或間接提供公開函式服務，只要妥善測試公開函式就會測試到私有函式的邏輯，若是某個特定私有函式未直接或間接被公開函式呼叫，則該私函式應該刪除。

    因此，應避免在產品碼中透過直接動態取得方法執行的撰寫方式，因為難以確認特定方法是否仍有被呼叫的可能，而未刪除的無用程式將造成未來閱讀的困難，甚至在之後被非預期的執行後，可能造成難以發現的錯誤，影響系統穩定性。

## 抽象類別無需測試

抽象類別無需測試，因為抽象類別無法獨立生成執行個體，抽象類別主要提供衍生類別對應的操作或共同的邏輯，因此抽象類別無需個別測試，只要其衍生類別有被逐一測試，則必然會執行抽象類別的邏輯，若是抽象類別內的操作沒有衍生類別呼叫使用，則表示該段程序沒有實質作用，應該被刪除。

## 外部元件的操作無需測試

對於外部元件的操作，例如，提供資料庫存取操作、檔案讀寫的代理類別或是其他自行的組件，主要的任務在於實做外部元件操作，此種類別的公開方法就無需測試；因為在單元測試層級，皆以外部元件能穩定提供服務為前題，不論外部元件是否為自行開發。

    單元測試的階段應假設外部元件是穩定可靠，因為對外部元件的驗證應該在元件使用的評估階段進行，若是日後外部元件確有問題，應該另設測試計畫確認，因為外部元件往往不是服務單一系統，不同系統引用相同外部元件是可預期的，所以應就外部元件建立對應測試計畫。

# 結語

測試碼的是否撰寫及應投入多少資源，可以透過三步驟來加以衡量。

1. 單元測試的「單元」應以「公開方法」為原則

2. 然後以是否具備商業邏輯加以判斷撰寫測試的必要

3. 最後以錯誤的所能承擔的風險決定測試應投入的資源多寡


