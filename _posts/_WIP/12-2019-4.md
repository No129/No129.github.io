如何建立 Internal 的 Fake 物件

# 建立 Fake 物件的組件
 在單元測試程式中為了隔離被測單元，免不了要建立「假物件」來與被測單元互動，最單純的情景就只是需要一個物件，有時則需要自訂反應。如果要自已手刻每一個使用到的假物件的話，可能會花上不少時間，而且同一個產品碼的物件的假物件，在不同情景下可能要有不同的反應，如果要逐一的實現，可能比寫產品碼還複雜、還要花時間，這就拉低了測試的性價比。

 所幸，這樣的問題對所有寫單元測試的人來說都是一樣的，所以動態生成假物件的解法也就被提出來，對於採用微軟方案來說，在地表最強 IDE 的 Visual Studio 面前，建立假物件的組件，就簡化為一個滑鼠右鍵的[新增 Fakes 組件]項目如此簡單。

 完整的說明可以參考[這篇文章][MSFakes]的說明，簡要說明如下：

 ## 建立 Fakes 組件
 以下步驟會在你的測試專案建立 Fakes 檔案夾，並建立對應的組件，同時將其加入測試專案的參考清單。

 1. 在 [方案總管] 中展開測試專案的參考清單。 如果在 Visual Basic 中工作，您必須選擇 [顯示所有檔案] 才能看到參考清單。
 2. 選取定義介面 (例如 IStockFeed) 之組件的參考。 在此參考的捷徑功能表上，選擇 [新增 Fakes 組件]。
 3. 重建方案。

 ## shim ( 墊片, 填充碼 ) vs stub ( 存根, 虛設常式 )

 對於介面 ( Interface ) 僅會建立 stub 假類別，而類別 ( Class ) 則會兩種假類別都提供。在類別提供的兩種假類別中，對運行的差異在於 Shim 假物件的方法，若是沒有提供自訂的填充碼，則會執行產品碼的邏輯，而 Stub 物件則是沒有動作，若是需要回傳的函式則回傳該型別的預設物件。

# 提供 Internal 類別的 Fake 物件
 可以看到 Microsoft Fakes 可以提供的都是「可見」的類別或介面的假物件，如果今天需要的 Internal 的介面或類別時就會無法正常在測試專案中取得。

 這時就需要合體技，參考[這篇文章][1]的說明，專案可以透過設定開放內部類別給特定組件存取，所以只要簡單在被測專案再加上一筆設定就可以讓假物件組件具備 Internal 介面或類別的假物件。


# 設定泛形方法的虛設常式
 假物件提供透過設定委派函式的方式，自訂假物件方法的回應處理，但是對泛形方法的虛設常式的設定則需要依據不同型別逐一建立對應的委派處理。




[1]:https://no129.github.io/qa-skill/2018/08/14/QA-Skill-001-OpenToTestProject.html "專案內部類別對測試專案開放"

[MSFakes]:https://docs.microsoft.com/zh-tw/visualstudio/test/isolating-code-under-test-with-microsoft-fakes?view=vs-2015 "使用 Micriosoft Fakes 在測試期間隔離程式碼"